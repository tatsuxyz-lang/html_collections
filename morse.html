<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>基地用モールス送信機</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #222; color: #ddd; padding: 20px; }
        #light { width: 100%; height: 200px; background: #000; border: 2px solid #444; margin: 20px 0; transition: 0.1s; }
        textarea { width: 90%; height: 100px; font-size: 1.2rem; background: #333; color: #fff; border: 1px solid #555; }
        button { padding: 15px 30px; font-size: 1.2rem; margin: 10px; cursor: pointer; background: #444; color: #fff; border: none; border-radius: 5px; }
        button:hover { background: #666; }
        .active-light { background: #fff !important; box-shadow: 0 0 50px #fff; }
    </style>
</head>
<body>

    <h1>モールス信号送信機</h1>
    <textarea id="inputText" placeholder="ここに入力（英数字）">SOS</textarea><br>
    
    <button onclick="playMorse()">光と音で送信開始</button>
    
    <div id="light"></div>
    <div id="status">待機中...</div>

    <script>
        // モールス符号の定義（ Property: Value の関係）
        const MORSE_CODE = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
            'Y': '-.--', 'Z': '--..', '1': '.----', '2': '..---', '3': '...--',
            '4': '....-', '5': '.....', '6': '-....', '7': '--...', '8': '---..',
            '9': '----.', '0': '-----', ' ': '/'
        };

        const unit = 200; // 短点（.）の長さ（ミリ秒）
        const ctx = new (window.AudioContext || window.webkitAudioContext)();

        async function playMorse() {
            const text = document.getElementById('inputText').value.toUpperCase();
            const light = document.getElementById('light');
            const status = document.getElementById('status');

            for (let char of text) {
                const code = MORSE_CODE[char];
                if (!code) continue;

                status.innerText = `送信中: ${char}`;

                for (let symbol of code) {
                    const duration = (symbol === '.') ? unit : unit * 3;
                    
                    if (symbol !== '/') {
                        // 音と光を出す（Propertyの変更）
                        light.classList.add('active-light');
                        const osc = ctx.createOscillator();
                        osc.connect(ctx.destination);
                        osc.start();
                        
                        await new Promise(r => setTimeout(r, duration));
                        
                        osc.stop();
                        light.classList.remove('active-light');
                    }
                    // 記号間の空白
                    await new Promise(r => setTimeout(r, unit));
                }
                // 文字間の空白
                await new Promise(r => setTimeout(r, unit * 2));
            }
            status.innerText = "送信完了";
        }
    </script>
</body>
</html>