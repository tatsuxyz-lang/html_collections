<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHINUACHI CTRL - d(^_^o)</title>
    <style>
        :root { --neon: #00ff41; --bg: #050505; --danger: #ff0000; }
        body { margin: 0; overflow: hidden; background: var(--bg); color: var(--neon); font-family: monospace; }
        
        /* 演出レイヤー */
        .chara { position: fixed; pointer-events: none; z-index: 100; }
        #log { position: fixed; top: 10px; left: 10px; font-size: 1rem; border: 1px solid var(--neon); padding: 5px; z-index: 1000; background: rgba(0,0,0,0.8); width: calc(100% - 30px); }
        
        /* スマホ用ボタン配置 */
        .ctrl-panel { 
            position: fixed; bottom: 20px; left: 0; width: 100%; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; box-sizing: border-box; z-index: 2000; 
        }
        button { 
            height: 70px; background: rgba(0,255,65,0.1); color: var(--neon); 
            border: 1px solid var(--neon); font-family: monospace; font-size: 14px; border-radius: 5px;
        }
        button:active { background: var(--neon); color: var(--bg); }
        .btn-reset { grid-column: span 2; border-color: var(--danger); color: var(--danger); height: 50px; margin-top: 5px; }
        
        .essay-mode { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 3rem; color: white; background: rgba(255,0,0,0.8);
            padding: 30px; border-radius: 20px; z-index: 5000; text-align: center; width: 80%;
        }
        .back-link { position: fixed; top: 60px; right: 10px; color: var(--neon); text-decoration: none; font-size: 12px; z-index: 3000; opacity: 0.5; }
    </style>
</head>
<body>
    <div id="log">READY. (真打) d(^_^o)</div>
    <a href="index.html" class="back-link">← HUB</a>

    <div class="ctrl-panel">
        <button onclick="perform('a')">下の句<br>(読み上げ)</button>
        <button onclick="perform('s')">生の声<br>(koe.mp3)</button>
        <button onclick="perform('p')">軍団召喚<br>(画像+声)</button>
        <button onclick="perform('t')">お札散布<br>(三角形)</button>
        <button onclick="perform('e')">個人の感想<br>(エッセイ)</button>
        <button onclick="perform('shift-a')">上の句<br>(mp3)</button>
        <button class="btn-reset" onclick="perform('q')">RESET (お後がよろしいようで)</button>
    </div>

<script>
const charaImg = 'unnamed (7).jpg';
let currentAudio = null;

function speak(text) {
    window.speechSynthesis.cancel();
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = "ja-JP";
    window.speechSynthesis.speak(uttr);
}

function playAudio(file) {
    if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
    currentAudio = new Audio(file);
    currentAudio.play().catch(e => console.log("再生失敗:素材がないか、操作が必要です"));
}

// 共通実行関数（キーボードとボタンの両方で動く）
function perform(action) {
    const log = document.getElementById('log');
    if (navigator.vibrate) navigator.vibrate(30); // 叩いた時の手応え

    if (action === 'q') {
        window.speechSynthesis.cancel();
        if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
        document.querySelectorAll('.chara, .essay-mode, div[style*="border-bottom"]').forEach(el => el.remove());
        log.innerHTML = "RESET. お後がよろしいようで。 d(^_^o)";
        speak("リセットしたよ。");
        return;
    }

    if (action === 'shift-a') {
        log.innerHTML = "上の句、抜刀！";
        playAudio('ue_no_ku.mp3');
    } else if (action === 'a') {
        speak("（下の句）三角形のお札が舞い散る、冬の空。");
    } else if (action === 's') {
        playAudio('koe.mp3');
    } else if (action === 'p') {
        const img = document.createElement('img');
        img.src = charaImg;
        img.className = 'chara';
        img.style.top = Math.random() * 50 + '%';
        img.style.left = Math.random() * 50 + '%';
        img.style.width = '200px';
        document.body.appendChild(img);
        setTimeout(() => img.remove(), 3000);
        speak("あら、ゴミを宝に変える知恵がついたみたいね。");
    } else if (action === 't') {
        dropTriangleMoney();
    } else if (action === 'e') {
        showEssay();
    }
}

// キーボード操作も残しておく（PCでも遊べるように）
window.addEventListener('keydown', (e) => {
    const key = e.key.toLowerCase();
    if (key === 'q') perform('q');
    else if (e.shiftKey && key === 'a') perform('shift-a');
    else perform(key);
});

function dropTriangleMoney() {
    for (let i = 0; i < 15; i++) {
        const money = document.createElement('div');
        money.style.cssText = `position: fixed; top: -50px; left: ${Math.random() * 100}vw; width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 40px solid #f0e68c; opacity: 0.8; z-index: 150; pointer-events: none;`;
        document.body.appendChild(money);
        money.animate([{ transform: 'translateY(0) rotate(0deg)' }, { transform: `translateY(110vh) rotate(${Math.random() * 1000}deg)` }], { duration: 3000 });
        setTimeout(() => money.remove(), 4000);
    }
    speak("三角形のお札よ。");
}

function showEssay() {
    const el = document.createElement('div');
    el.className = 'essay-mode';
    el.innerHTML = "※個人の感想です<br>d(^_^o)";
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 2000);
    speak("これ、ただの僕の感想だからｗ");
}
</script>
</body>
</html>
